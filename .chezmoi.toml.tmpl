# -*-mode:conf-toml-*- vim:ft=toml

{{/* boolean feature tags */}}
{{- $isVirtual := false -}}{{/* true if this machine is ephemeral, e.g. a cloud or VM instance */}}
{{ $isMobile := false }}{{/* true if this is a machine that is not a laptop */}}
{{- $personal := false -}}{{/* true if this machine should have personal secrets */}}
{{ $shell := "fish" }}
{{- "" -}}

{{/* detect GitHub codespaces, VSCode remote containers, Docker containers, Multipass VMs, and Vagrant boxes */}}
{{- if or (env "CODESPACES") (env "REMOTE_CONTAINERS_IPC") (eq .chezmoi.username "root" "ubuntu" "vagrant" "vscode") -}}
{{-   $isVirtual = true -}}
{{- end -}}

{{- if not $isVirtual -}}
{{-   if stdinIsATTY -}}
{{-     $isVirtual = promptBoolOnce . "isVirtual" "isVirtual" -}}
{{-   else -}}
{{-     $isVirtual = true -}}
{{-     $headless = true -}}
{{-   end -}}
{{- end -}}

{{- if $isVirtual -}}
    {{-  $email := "simon@burgr.io" -}}
    {{-  $name := "sb" }}
{{- else -}}
    {{- $email := promptStringOnce . "email" "Email" "simon@burgr.io" }}
    {{- $name := promptStringOnce . "name" "Name" "sb" }}
    {{- $isMobile = promptBoolOnce . "isMobile" "is this a a laptop with wifi? (y/n)" }}
    {{- $isWorkMachine := promptBoolOnce . "isWorkMachine" "is this a work machine (y/n)" }}
    {{- if $isWorkMachine }}
        {{- $manualSetup = promptBoolOnce . "manualSetup" "Do you want to setup this machine manually (y/n)" }}
    {{- end }}
{{- end -}}

[data]
        name =  "{{ $name }}"
        email = "{{ $email }}"
        shell = "{{ $shell }}"
        isServer = "{{ $isServer }}"
        isWorkMachine = "{{ $isWorkMachine }}"
        manualSetup = "{{ $manualSetup }}"
        isVirtual = "{{ $isVirtual }}"
        isMobile = "{{ $isMobile }}"
