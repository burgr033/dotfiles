#!/bin/bash

{{ $sudo := "sudo " -}}
{{ if eq .chezmoi.username "root" -}}
{{   $sudo = "" -}}
{{ end -}}

set -eufo pipefail

{{ if eq .chezmoi.osRelease.id "ubuntu" -}}
#UBUNTU

#lazygit
if ! command -v lazygit &> /dev/null
  then
    LAZYGIT_VERSION=$(curl -s "https://api.github.com/repos/jesseduffield/lazygit/releases/latest" | grep -Po '"tag_name": "v\K[^"]*')
    curl -Lo lazygit.tar.gz "https://github.com/jesseduffield/lazygit/releases/latest/download/lazygit_${LAZYGIT_VERSION}_Linux_x86_64.tar.gz"
    tar xf lazygit.tar.gz lazygit
    install lazygit ~/.local/bin
    rm lazygit.tar.gz lazygit
  fi

{{ $packages_ubuntu := list
     "bat"
     "curl"
     "direnv"
     "fd-find"
     "thefuck"
     "ansible"
     "git-lfs"
     "jq"
     "ripgrep"
     "fzf"
     "htop"
     "python3-dev"
     "python3-pip"
     "python3-setuptools"
     "bat"
     "virtualenvwrapper"
     "python3-pynvim"
     "gdu"
     "tree"
     "units"
     "zsh" -}}
	 
{{ $classicSnaps := list
	"nvim" -}}

{{ $sudo }}apt-get update
{{ $sudo }}apt-get install -y {{ $packages_ubuntu | join " " }}

{{ if lookPath "snap" }}
{{   range $classicSnaps }}
{{ $sudo }}snap install --classic {{ . }}
{{   end }}
{{ end }}

{{ end -}}

#####################################################################

{{ if eq .chezmoi.osRelease.idLike "arch" -}}

#ARCH

{{ $packages_arch := list
     "bat"
     "curl"
     "direnv"
     "fd"
     "git-lfs"
     "jq"
     "neovim"
     "ripgrep"
     "fzf"
     "htop"
     "python"
     "ansible-core"
     "python-pip"
     "python-virtualenvwrapper"
     "thefuck"
     "python-setuptools"
     "bat"
     "python-pynvim"
     "gdu"
     "tree"
     "lazygit"
     "bottom"
     "zsh" -}}


{{ $sudo }}sudo pacman --needed --noconfirm -Sy {{ $packages_arch | join " " }}

{{ end -}}

#####################################################################

{{ if eq .chezmoi.osRelease.idLike "rhel" -}}
#CENTOS
{{ end -}}
